# 多评估器独立人格分析系统技术规范

## 1. 系统概述

### 1.1 目标
实现三个本地LLM评估器（deepseek_r1、mistral、qwen3_30b）对心理测评报告的独立分析和对比评估。

### 1.2 核心原则
- **独立性**: 每个评估器独立完整分析所有数据
- **对比性**: 提供评估器间结果对比和一致性分析
- **分段处理**: 每个评估器使用相同的分段逻辑处理大数据
- **问题级别评分**: 基于问题级别评分累积到Big Five分数，再转换为MBTI

## 2. 系统架构

### 2.1 数据流
```
原始报告 → 格式转换 → 报告精简 → 分段处理 → 独立评估 → 结果对比 → 汇总分析
```

### 2.2 评估器工作流程
```
每个评估器独立执行:
1. 接收相同的问题分段
2. 对每个问题进行Big Five评分 (1-10分制)
3. 累积所有问题分数得到最终Big Five分数
4. 基于Big Five分数转换为MBTI类型
5. 输出完整的分析结果
```

### 2.3 对比分析机制
- **MBTI一致性**: 计算评估器间MBTI类型的一致率
- **Big Five变异性**: 分析各维度分数的变异程度
- **评估器性能**: 统计成功率和分析质量

## 3. 技术实现规范

### 3.1 分段处理
- **最大分段大小**: 50KB
- **每段最大问题数**: 5个
- **分段逻辑**: 按顺序分段，保持数据完整性

### 3.2 评估器调用
- **调用方式**: 每个评估器独立调用Ollama API
- **系统提示**: 标准化的心理分析提示词
- **用户输入**: 结构化的问题数据
- **超时设置**: 每个段分析5分钟超时

### 3.3 数据结构
```json
{
  "source_file": "文件名",
  "analysis_time": "时间戳",
  "segment_count": "分段数",
  "question_count": "问题总数",
  "evaluator_results": {
    "evaluator_name": {
      "segment_count": "分段数",
      "question_count": "问题数",
      "segment_results": ["分段结果数组"],
      "final_scores": {
        "big_five": {...},
        "mbti": {...}
      },
      "analysis_time": "时间戳"
    }
  },
  "comparison_analysis": {
    "mbti_comparison": {...},
    "big_five_comparison": {...},
    "consensus_analysis": {...},
    "disagreement_analysis": {...}
  }
}
```

### 3.4 错误处理
- **评估器失败**: 使用模拟结果作为备用，记录失败原因
- **数据格式错误**: 严格验证输入输出格式
- **网络超时**: 重试机制，最多3次重试

## 4. 测试规范

### 4.1 单元测试
- 测试分段逻辑正确性
- 测试评估器调用机制
- 测试结果聚合算法
- 测试对比分析计算

### 4.2 集成测试
- 测试完整工作流程
- 测试多评估器并发执行
- 测试大数据量处理性能
- 测试错误恢复机制

### 4.3 验收标准
- **成功率**: ≥95%的文件能被所有评估器成功分析
- **一致性**: MBTI类型评估器间一致性≥70%
- **性能**: 每个文件处理时间≤10分钟
- **准确性**: Big Five分数合理性验证

## 5. 部署要求

### 5.1 环境要求
- Ollama服务运行
- 三个评估器模型已下载
- 足够的内存和存储空间
- 网络连接稳定

### 5.2 配置要求
- config/ollama_config.json配置正确
- 评估器上下文窗口≥128K
- 日志记录和监控机制

## 6. 维护规范

### 6.1 日志记录
- 详细记录每个评估器的调用过程
- 记录失败原因和错误信息
- 记录处理时间和性能指标

### 6.2 性能监控
- 监控评估器响应时间
- 监控成功率分布
- 监控系统资源使用情况

### 6.3 数据备份
- 定期备份分析结果
- 保存原始数据和中间结果
- 维护分析历史记录